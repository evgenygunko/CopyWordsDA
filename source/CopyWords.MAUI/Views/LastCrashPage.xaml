<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/maui/global"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:DataType="LastCrashViewModel"
             x:Class="CopyWords.MAUI.Views.LastCrashPage"
             x:Name="contentPageLastCrashPage"
             Title="App Crash Report"
             BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundLightColor}, Dark={StaticResource AppBackgroundDarkColor}}">

    <ContentPage.Behaviors>
        <EventToCommandBehavior
            EventName="Appearing"
            BindingContext="{Binding Path=BindingContext, Source={x:Reference contentPageLastCrashPage}, x:DataType=LastCrashPage}"
            Command="{Binding GetCrashDumpInfoCommand}" />
    </ContentPage.Behaviors>

    <ScrollView>
        <VerticalStackLayout Spacing="20" Margin="20">

            <!-- Header Section with Icon -->
            <VerticalStackLayout Spacing="16">
                <!-- Warning Symbol -->
                <Label Text="âš "
                           FontSize="{StaticResource FontSizeHuge}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />

                <!-- Title -->
                <Label Text="Application Crash Detected"
                           FontSize="{StaticResource FontSizeLarge}"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />

                <!-- Subtitle -->
                <Label Text="The application encountered an unexpected error during the last session"
                           FontSize="{StaticResource FontSizeBody}"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}"
                           HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Crash Details Card -->
            <Border BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 12"
                    Padding="20"
                    Margin="0,0,0,0">
                <VerticalStackLayout Spacing="16">

                    <!-- Section Header -->
                    <Label Text="Crash Information"
                           FontSize="{StaticResource FontSizeSubtitle}"
                           FontAttributes="Bold" />

                    <!-- Crash Time -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="Crash Time"
                                   FontSize="{StaticResource FontSizeCaption}"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />

                            <Border BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                                    Stroke="Transparent"
                                    StrokeShape="RoundRectangle 8"
                                    Padding="12"
                                    Margin="0,0,0,0">

                                <Label Text="{Binding CrashTime}"
                                       FontSize="{StaticResource FontSizeBody}"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"
                                       LineBreakMode="WordWrap" />
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Separator -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />

                    <!-- Error Message -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="Error Details"
                                       FontSize="{StaticResource FontSizeCaption}"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                       VerticalOptions="Center" />

                                <ImageButton BackgroundColor="Transparent"
                                            WidthRequest="44"
                                            HeightRequest="44"
                                            Command="{Binding CopyErrorMessageCommand}">
                                    <ImageButton.Source>
                                        <FontImageSource
                                            Color="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                            FontFamily="MaterialIconsOutlined-Regular"
                                            Glyph="{x:Static MaterialDesignIconFonts.Content_copy}" />
                                    </ImageButton.Source>
                                </ImageButton>
                            </HorizontalStackLayout>

                            <Border BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                                    Stroke="Transparent"
                                    StrokeShape="RoundRectangle 8"
                                    Padding="12"
                                    Margin="0,0,0,0">

                                <Label Text="{Binding ErrorMessage}"
                                       FontSize="{StaticResource FontSizeBody}"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"
                                       LineBreakMode="WordWrap" />
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Separator -->
                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />

                    <!-- Stack Trace -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">

                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="Stack Trace"
                                       FontSize="{StaticResource FontSizeCaption}"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                       VerticalOptions="Center" />
                                <ImageButton BackgroundColor="Transparent"
                                            WidthRequest="44"
                                            HeightRequest="44"
                                            Command="{Binding CopyStackTraceCommand}">
                                    <ImageButton.Source>
                                        <FontImageSource
                                            Color="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                            FontFamily="MaterialIconsOutlined-Regular"
                                            Glyph="{x:Static MaterialDesignIconFonts.Content_copy}" />
                                    </ImageButton.Source>
                                </ImageButton>
                            </HorizontalStackLayout>

                            <!-- Stack Trace -->
                            <ScrollView MaximumHeightRequest="300">
                                <Border BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                                        Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="16"
                                        Margin="0,0,0,0">

                                <VerticalStackLayout>

                                    <Label Text="{Binding ExceptionName}"
                                           FontSize="{StaticResource FontSizeSmall}"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource Gray200}}"
                                           LineBreakMode="WordWrap" />

                                    <Label Text="{Binding StackTrace}"
                                           FontSize="{StaticResource FontSizeSmall}"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource Gray200}}"
                                           LineBreakMode="WordWrap" />
                                </VerticalStackLayout>
                                </Border>
                            </ScrollView>
                        </VerticalStackLayout>
                    </Grid>


                </VerticalStackLayout>
            </Border>

            <!-- Action Buttons -->
            <HorizontalStackLayout HorizontalOptions="End">

                <Button
                    Grid.Row="0"
                    Grid.Column="0"
                    Margin="5"
                    Text="Send report"
                    Command="{Binding SendEmailCommand}" />

                <Button
                    Grid.Row="0"
                    Grid.Column="1"
                    Margin="10,5,0,5"
                    Text="Continue"
                    Command="{Binding CloseDialogCommand}" />
            </HorizontalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>